<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Seed Inventory — AutoFix</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:900px;margin:18px auto;padding:12px}
    .btn{background:#1f6feb;color:#fff;padding:10px 14px;border:none;border-radius:6px;cursor:pointer}
    label{display:inline-block;margin:8px 0}
    textarea{width:100%;min-height:120px;padding:8px;border-radius:6px}
    pre{background:#f4f6fb;padding:10px;border-radius:6px}
    .small{font-size:13px;color:#666}
    .warn{color:#b33}
  </style>

  <!-- Firebase SDKs (must be present) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>AutoFix — Seed Inventory to Firestore (Test Mode)</h2>

  <p class="small">Replace the firebaseConfig below with your Firebase Web App configuration before clicking "Seed Inventory".</p>

  <h3>1) Firebase config (edit)</h3>
  <pre id="configExample" class="small">
var firebaseConfig = {
  apiKey: "REPLACE_API_KEY",
  authDomain: "REPLACE_PROJECT_ID.firebaseapp.com",
  projectId: "REPLACE_PROJECT_ID",
  storageBucket: "REPLACE_PROJECT_ID.appspot.com",
  messagingSenderId: "REPLACE_SENDER_ID",
  appId: "REPLACE_APP_ID"
};
  </pre>

  <h3>2) Options</h3>
  <label><input type="checkbox" id="clearBefore" /> Clear existing <code>spareParts</code> collection before seeding (recommended if re-running)</label>

  <div style="margin-top:12px">
    <button id="seedBtn" class="btn">Seed Inventory</button>
    <span id="status" style="margin-left:12px" class="small"></span>
  </div>

  <h3 style="margin-top:18px">Notes</h3>
  <p class="small">This will create documents inside the Firestore collection <code>spareParts</code>. Items in the "Tires" category include a <code>size</code> field and category set to <code>"Tires"</code>. Default stock is set to <code>10</code> for each item – you can change that in the script below.</p>

  <script>
  // ===========================
  // EDIT THIS: your Firebase config
  // Replace string values with your project's values from Firebase Console -> Project settings -> SDK.
  // Do NOT remove quotes or trailing commas must be correct.
  // ===========================
  var firebaseConfig = {
    apiKey: "AIzaSyDHhIc-AFmj_YKZqtEk5aNan_qv4jW1-Ss",
    authDomain: "autofixspareparts-c9ff4.firebaseapp.com",
    projectId: "autofixspareparts-c9ff4",
    storageBucket: "autofixspareparts-c9ff4.firebasestorage.app",
    messagingSenderId: "734766153921",
    appId: "1:734766153921:web:30c08e2964f6b0e2949440"
  };
  // ===========================

  // Initialize Firebase
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const db = firebase.firestore();

  // Default stock for each seeded item
  const DEFAULT_STOCK = 10;

  // ---- Seed data (inventory already entered) ----
  // Regular parts (name, price, category='General')
  const parts = [
    ["Brake fluid", 300],
    ["Catol CC", 600],
    ["lens QR", 600],
    ["Hand Pump", 1500],
    ["Diesel 1liter", 350],
    ["ASF", 350],
    ["Oil filter", 350],
    ["Engine mtn E24", 1500],
    ["machine oil", 60],
    ["Headgasket TD-27", 2500],
    ["Balljoint down E24", 2500],
    ["Brake pad 013", 1500],
    ["lens complete", 600],
    ["brakepad VBL", 1500],
    ["clutch kit 1", 200],
    ["clutch kit 2", 500],
    ["chrome nut", 50],
    ["tape", 50],
    ["head gasket 5l", 3000],
    ["combined spanner", 1500],
    ["brakepad 148", 1700],
    ["lens shark clear", 200],
    ["timing belt", 1500],
    ["Ak grease", 450],
    ["shark/nsn clutch cylinder", 1500],
    ["clutch brake", 800],
    ["silicone tube metal", 500],
    ["silicone tube clear", 350],
    ["clutch plate", 2000],
    ["brake pad 004", 1700],
    ["h/pipe BTmNSN", 1500],
    ["complete lens shark", 600],
    ["glass lens shark", 600],
    ["balljoint E25 TWN Down", 2400],
    ["Gasket exhaust", 250],
    ["horse pipe NSN", 1500],
    ["horse pipe sharke", 1500],
    ["Air cleaner", 450],
    ["secraniser", 500],
    ["kit", 250],
    ["clutch disk", 2500],
    ["bearing hub", 2500],
    ["stabilizer link", 500],
    ["radiator cap", 500],
    ["grease cup", 150],
    ["bearing 12649", 600],
    ["Grease foyot", 500],
    ["kit", 200],
    ["bolt No.8", 20],
    ["Bolt no.10", 20],
    ["bolt no.13", 20],
    ["bolt no.14", 30],
    ["bolt no.17", 40],
    ["brake disk shark", 2500]
  ];

  // Tires as (size, price) — they will be stored with category 'Tires' and size field
  const tires = [
    ["195/15", 6500],
    ["195/14", 6400],
    ["195/65/15", 5500],
    ["185/70/13", 4800],
    ["185/70/14", 4800],
    ["175/70/14", 4800]
  ];

  // Utility: delete all docs in spareParts (batched)
  async function clearSpareParts() {
    const snapshot = await db.collection('spareParts').get();
    if (snapshot.empty) return 0;
    const batchSize = 200; // safe batch size
    let deleted = 0;
    const docs = snapshot.docs;
    for (let i = 0; i < docs.length; i += batchSize) {
      const batch = db.batch();
      const chunk = docs.slice(i, i + batchSize);
      chunk.forEach(d => batch.delete(d.ref));
      await batch.commit();
      deleted += chunk.length;
    }
    return deleted;
  }

  // Function to seed inventory
  async function seedInventory() {
    const statusEl = document.getElementById('status');
    const clearBefore = document.getElementById('clearBefore').checked;
    try {
      statusEl.textContent = 'Working...';
      // Optionally clear existing collection
      if (clearBefore) {
        statusEl.textContent = 'Clearing existing spareParts collection...';
        const removed = await clearSpareParts();
        statusEl.textContent = `Cleared ${removed} existing documents. Continuing to seed...`;
      }

      let added = 0;
      // Add general parts
      for (const [name, price] of parts) {
        const doc = {
          name: String(name),
          price: Number(price),
          stock: DEFAULT_STOCK,
          category: 'General',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        await db.collection('spareParts').add(doc);
        added++;
      }

      // Add tires
      for (const [size, price] of tires) {
        const doc = {
          name: `Tire ${size}`,
          size: String(size),
          price: Number(price),
          stock: DEFAULT_STOCK,
          category: 'Tires',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        await db.collection('spareParts').add(doc);
        added++;
      }

      statusEl.textContent = `Done. Added ${added} items to spareParts. Check Firestore console.`;
      // Disable button after success to prevent accidental duplicate runs
      document.getElementById('seedBtn').disabled = true;
    } catch (err) {
      console.error('Seeding error', err);
      statusEl.innerHTML = '<span class="warn">Error seeding inventory. See console for details.</span>';
    }
  }

  // Wire up button
  document.getElementById('seedBtn').addEventListener('click', async () => {
    if (!confirm('Are you sure you want to seed the inventory into Firestore? Make sure firebaseConfig is set and Firestore is in test mode.')) return;
    await seedInventory();
  });
  </script>
</body>
</html>
